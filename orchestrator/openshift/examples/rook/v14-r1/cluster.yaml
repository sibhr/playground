#
# Docs https://github.com/rook/rook/blob/v1.0.1/Documentation/ceph-cluster-crd.md
# File cloned from https://github.com/rook/rook/blob/v1.0.1/cluster/examples/kubernetes/ceph/cluster.yaml
#
# Notes:
# - mon count and storage nodes to an equal number  
#
#################################################################################################################
# Define the settings for the rook-ceph cluster with settings that should only be used in a test environment.
# A single filestore OSD will be created in the dataDirHostPath.
# For example, to create the cluster:
#   kubectl create -f common.yaml
#   kubectl create -f operator.yaml
#   kubectl create -f cluster-test.yaml
#################################################################################################################

apiVersion: ceph.rook.io/v1
kind: CephCluster
metadata:
  name: rook-ceph
  namespace: rook-ceph
spec:
  cephVersion:
    image: ceph/ceph:v14.2.1-20190430
    allowUnsupported: true
  dataDirHostPath: /var/lib/rook
  mon:
    count: 1
    allowMultiplePerNode: false
  dashboard:
    enabled: false
  # hostNetwork: true REQUIRE to add scc networkhost to rook servvice account (see readme)
  network:
    hostNetwork: true
  rbdMirroring:
    workers: 0
  placement:
    all:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: role
              operator: In
              values:
              - storage-node
      podAffinity:
      podAntiAffinity:
      tolerations:
      - key: storage-node
        operator: Exists
  storage:
    useAllNodes: false
    useAllDevices: false
    deviceFilter:
    config:
      databaseSizeMB: "1024" # this value can be removed for environments with normal sized disks (100 GB or larger)
      journalSizeMB: "1024"  # this value can be removed for environments with normal sized disks (20 GB or larger)
      osdsPerDevice: "1" # this value can be overridden at the node or device level
    # directories:
    # - path: /opt/openshift/rook
    nodes:
    - name: "okd-worker-01.vm.local"
      devices:
      - name: "sdb"

    # - name: "okd-worker-01.vm.local"
      # directories:
      # - path: "/var/lib/rook"
      # devices:
      # - name: "sdb"
#      - name: "nvme01" # multiple osds can be created on high performance devices
#        config:
#          osdsPerDevice: "5"
